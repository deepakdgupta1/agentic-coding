name: Installer Canary (Docker)

on:
  schedule:
    - cron: "30 7 * * *" # 7:30 AM UTC daily
  workflow_dispatch:
    inputs:
      ubuntu:
        description: "Ubuntu version: 24.04, 25.04, or all"
        default: "24.04"
        required: true
      mode:
        description: "Install mode: vibe or safe"
        default: "vibe"
        required: true

jobs:
  canary:
    runs-on: ubuntu-latest
    timeout-minutes: 90
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run installer canary
        env:
          ACFS_CHECKSUMS_REF: main
        run: |
          chmod +x ./tests/vm/test_install_ubuntu.sh

          if [[ "${{ github.event_name }}" == "workflow_dispatch" && "${{ inputs.ubuntu }}" == "all" ]]; then
            ./tests/vm/test_install_ubuntu.sh --all --mode "${{ inputs.mode }}"
          else
            ./tests/vm/test_install_ubuntu.sh --ubuntu "${{ inputs.ubuntu }}" --mode "${{ inputs.mode }}"
          fi
